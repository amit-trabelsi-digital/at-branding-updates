# PROJECT MEMORY - Mental Coach

## שינויים במערכת ההרשאה והוספת משתמשים (2025-01-29 - v1.3.4)

### שינויים עיקריים:
- **הסרת חובה משדה סיסמה**: משתמשים יכולים להירשם רק עם SMS/Google ללא סיסמה
- **הסרת Apple**: הוסרה אפשרות ההתחברות עם Apple מהמערכת
- **SMS כברירת מחדל**: שיטת ההתחברות הראשית היא SMS
- **מנהלים**: מקבלים אוטומטית גישה גם ל-SMS וגם ל-Google

### פרטים טכניים:
- סיסמה אקראית נוצרת אוטומטית אם לא סופקה
- allowedAuthMethods ברירת מחדל: `{email: false, sms: true, google: true}`
- מנהלים מקבלים תמיד SMS ו-Google מופעלים

## המרת טלפון אוטומטית בעריכת משתמש (2025-01-27 - v1.3.3)

### תכונות חדשות:
- **המרה אוטומטית**: מספרי טלפון ישראליים (05X-XXXXXXX) מומרים אוטומטית לפורמט בינלאומי (+972)
- **עדכון Firebase Phone Number**: כשמזינים מספר בשדה הטלפון הרגיל, השדה של Firebase מתעדכן אוטומטית
- **הפעלת SMS אוטומטית**: כשיש מספר טלפון בפיירבייס, אפשרות ההתחברות עם SMS נבחרת אוטומטית

### שינויים:
- שדה "טלפון וואטסאפ של המאמן" הופך לאופציונלי (לא חובה)

### פרטים טכניים:
- פונקציית `convertToInternationalFormat` להמרת מספרים ישראליים
- שימוש ב-`watch` של react-hook-form למעקב אחר שינויים
- `useEffect` hooks לעדכון אוטומטי של שדות קשורים

## פעולות מרובות בטבלת המשתמשים (2025-01-27 - v1.3.2)

### תכונות חדשות:
- **בחירה מרובה**: אפשרות לסמן מספר משתמשים באמצעות checkboxes
- **מחיקה מרובה**: כפתור למחיקת כל המשתמשים המסומנים עם דיאלוג אישור
- **עדכון מנוי מרובה**: כפתור לשינוי סוג מנוי לכל המשתמשים המסומנים
- **דיאלוג בחירת מנוי**: אפשרות לבחור בין בסיסי/מתקדם/פרימיום
- **משוב למשתמש**: הודעות הצלחה/שגיאה לאחר ביצוע הפעולות

### פרטים טכניים:
- שימוש ב-`GridRowSelectionModel` מ-MUI DataGrid
- ביצוע פעולות מרובות במקביל עם `Promise.all`
- מניעת קונפליקט בין לחיצה על checkbox ללחיצה על שורה

## עדכונים בטבלת המשתמשים (2025-01-27 - v1.3.1)

### שינויים בממשק הניהול:
- הוספת עמודת טלפון בטבלת המשתמשים (מציג "חסר" אם אין מספר)
- הסרת אייקון Apple משיטות ההתחברות (לא רלוונטי לפרויקט)
- הוספת יכולת לחיצה על שורה בטבלה לפתיחת דיאלוג עריכה
- הוספת סטייל hover וסמן עכבר לשורות בטבלה

## תמיכה בניהול מספרי טלפון וסוג התחברות (2025-01-27 - v1.3.0)

### שינויים שבוצעו:

#### 1. Backend (mental-coach-api):
- **מודל משתמש** - הוספת שדות חדשים:
  - `allowedAuthMethods`: אובייקט המגדיר אילו שיטות התחברות מורשות (email, sms, google, apple)
  - `firebasePhoneNumber`: מספר טלפון בפורמט E.164 לשימוש ב-Firebase Auth
  
- **בקר משתמשים** - עדכון פונקציית `updateUser`:
  - סנכרון אוטומטי של מספר הטלפון עם Firebase Auth
  - טיפול בשגיאות Firebase
  
- **בקר אימות** - הוספת פונקציה חדשה `checkAuthMethod`:
  - בדיקה האם שיטת התחברות מסוימת מורשית למשתמש
  - החזרת מספר הטלפון אם השיטה היא SMS
  
- **נתיבים** - הוספת endpoint חדש:
  - `POST /api/auth/check-auth-method`

#### 2. Frontend Admin (mental-coach-admin):
- **טיפוסים** - עדכון טיפוס User עם השדות החדשים
  
- **דיאלוג משתמש** - הוספת סעיף "הגדרות התחברות":
  - שדה לעדכון מספר טלפון בפיירבייס (עם ולידציה)
  - תיבות סימון לבחירת שיטות התחברות מורשות
  
- **טבלת משתמשים** - הוספת עמודה חדשה:
  - הצגת אייקונים של שיטות ההתחברות המורשות

#### 3. תיעוד:
- יצירת קובץ `AUTH_METHODS_MANAGEMENT.md` עם הוראות מפורטות
- עדכון Postman collection עם ה-endpoint החדש
- עדכון CHANGELOG בשני הפרויקטים

### ברירות מחדל:
- Email: מורשה (true)
- SMS: לא מורשה (false)
- Google: מורשה (true)
- Apple: מורשה (true)

### הערות חשובות:
1. מספרי טלפון חייבים להיות בפורמט E.164 (+972501234567)
2. עדכון מספר טלפון מסנכרן אוטומטית עם Firebase Auth
3. רק מנהלי מערכת יכולים לערוך הגדרות התחברות