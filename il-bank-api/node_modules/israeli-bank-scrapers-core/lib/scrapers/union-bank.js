"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("core-js/modules/es.symbol.description.js");
require("core-js/modules/es.array.iterator.js");
require("core-js/modules/es.promise.js");
require("core-js/modules/es.regexp.exec.js");
require("core-js/modules/es.string.replace.js");
require("core-js/modules/es.string.trim.js");
var _moment = _interopRequireDefault(require("moment"));
var _constants = require("../constants");
var _elementsInteractions = require("../helpers/elements-interactions");
var _navigation = require("../helpers/navigation");
var _transactions = require("../transactions");
var _baseScraperWithBrowser = require("./base-scraper-with-browser");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const BASE_URL = 'https://hb.unionbank.co.il';
const TRANSACTIONS_URL = `${BASE_URL}/eBanking/Accounts/ExtendedActivity.aspx#/`;
const DATE_FORMAT = 'DD/MM/YY';
const NO_TRANSACTION_IN_DATE_RANGE_TEXT = 'לא קיימות תנועות מתאימות על פי הסינון שהוגדר';
const DATE_HEADER = 'תאריך';
const DESCRIPTION_HEADER = 'תיאור';
const REFERENCE_HEADER = 'אסמכתא';
const DEBIT_HEADER = 'חובה';
const CREDIT_HEADER = 'זכות';
const PENDING_TRANSACTIONS_TABLE_ID = 'trTodayActivityNapaTableUpper';
const COMPLETED_TRANSACTIONS_TABLE_ID = 'ctlActivityTable';
const ERROR_MESSAGE_CLASS = 'errInfo';
const ACCOUNTS_DROPDOWN_SELECTOR = 'select#ddlAccounts_m_ddl';
function getPossibleLoginResults() {
  const urls = {};
  urls[_baseScraperWithBrowser.LoginResults.Success] = [/eBanking\/Accounts/];
  urls[_baseScraperWithBrowser.LoginResults.InvalidPassword] = [/InternalSite\/CustomUpdate\/leumi\/LoginPage.ASP/];
  return urls;
}
function createLoginFields(credentials) {
  return [{
    selector: '#uid',
    value: credentials.username
  }, {
    selector: '#password',
    value: credentials.password
  }];
}
function getAmountData(amountStr) {
  const amountStrCopy = amountStr.replace(',', '');
  return parseFloat(amountStrCopy);
}
function getTxnAmount(txn) {
  const credit = getAmountData(txn.credit);
  const debit = getAmountData(txn.debit);
  return (Number.isNaN(credit) ? 0 : credit) - (Number.isNaN(debit) ? 0 : debit);
}
function convertTransactions(txns) {
  return txns.map(txn => {
    const convertedDate = (0, _moment.default)(txn.date, DATE_FORMAT).toISOString();
    const convertedAmount = getTxnAmount(txn);
    return {
      type: _transactions.TransactionTypes.Normal,
      identifier: txn.reference ? parseInt(txn.reference, 10) : undefined,
      date: convertedDate,
      processedDate: convertedDate,
      originalAmount: convertedAmount,
      originalCurrency: _constants.SHEKEL_CURRENCY,
      chargedAmount: convertedAmount,
      status: txn.status,
      description: txn.description,
      memo: txn.memo
    };
  });
}
function getTransactionDate(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DATE_HEADER]] || '').trim();
}
function getTransactionDescription(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DESCRIPTION_HEADER]] || '').trim();
}
function getTransactionReference(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[REFERENCE_HEADER]] || '').trim();
}
function getTransactionDebit(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[DEBIT_HEADER]] || '').trim();
}
function getTransactionCredit(tds, txnsTableHeaders) {
  return (tds[txnsTableHeaders[CREDIT_HEADER]] || '').trim();
}
function extractTransactionDetails(txnRow, txnsTableHeaders, txnStatus) {
  const tds = txnRow.innerTds;
  return {
    status: txnStatus,
    date: getTransactionDate(tds, txnsTableHeaders),
    description: getTransactionDescription(tds, txnsTableHeaders),
    reference: getTransactionReference(tds, txnsTableHeaders),
    debit: getTransactionDebit(tds, txnsTableHeaders),
    credit: getTransactionCredit(tds, txnsTableHeaders),
    memo: ''
  };
}
function isExpandedDescRow(txnRow) {
  return txnRow.id === 'rowAdded';
}

/* eslint-disable no-param-reassign */
function editLastTransactionDesc(txnRow, lastTxn) {
  lastTxn.description = `${lastTxn.description} ${txnRow.innerTds[0]}`;
  return lastTxn;
}
function handleTransactionRow(txns, txnsTableHeaders, txnRow, txnType) {
  if (isExpandedDescRow(txnRow)) {
    const lastTransaction = txns.pop();
    if (lastTransaction) {
      txns.push(editLastTransactionDesc(txnRow, lastTransaction));
    } else {
      throw new Error('internal union-bank error');
    }
  } else {
    txns.push(extractTransactionDetails(txnRow, txnsTableHeaders, txnType));
  }
}
async function getTransactionsTableHeaders(page, tableTypeId) {
  const headersMap = [];
  const headersObjs = await (0, _elementsInteractions.pageEvalAll)(page, `#WorkSpaceBox #${tableTypeId} tr[class='header'] th`, null, ths => {
    return ths.map((th, index) => ({
      text: th.innerText.trim(),
      index
    }));
  });
  for (const headerObj of headersObjs) {
    headersMap[headerObj.text] = headerObj.index;
  }
  return headersMap;
}
async function extractTransactionsFromTable(page, tableTypeId, txnType) {
  const txns = [];
  const transactionsTableHeaders = await getTransactionsTableHeaders(page, tableTypeId);
  const transactionsRows = await (0, _elementsInteractions.pageEvalAll)(page, `#WorkSpaceBox #${tableTypeId} tr[class]:not([class='header'])`, [], trs => {
    return trs.map(tr => ({
      id: tr.getAttribute('id') || '',
      innerTds: Array.from(tr.getElementsByTagName('td')).map(td => td.innerText)
    }));
  });
  for (const txnRow of transactionsRows) {
    handleTransactionRow(txns, transactionsTableHeaders, txnRow, txnType);
  }
  return txns;
}
async function isNoTransactionInDateRangeError(page) {
  const hasErrorInfoElement = await (0, _elementsInteractions.elementPresentOnPage)(page, `.${ERROR_MESSAGE_CLASS}`);
  if (hasErrorInfoElement) {
    const errorText = await page.$eval(`.${ERROR_MESSAGE_CLASS}`, errorElement => {
      return errorElement.innerText;
    });
    return errorText.trim() === NO_TRANSACTION_IN_DATE_RANGE_TEXT;
  }
  return false;
}
async function chooseAccount(page, accountId) {
  const hasDropDownList = await (0, _elementsInteractions.elementPresentOnPage)(page, ACCOUNTS_DROPDOWN_SELECTOR);
  if (hasDropDownList) {
    await (0, _elementsInteractions.dropdownSelect)(page, ACCOUNTS_DROPDOWN_SELECTOR, accountId);
  }
}
async function searchByDates(page, startDate) {
  await (0, _elementsInteractions.dropdownSelect)(page, 'select#ddlTransactionPeriod', '004');
  await (0, _elementsInteractions.waitUntilElementFound)(page, 'select#ddlTransactionPeriod');
  await (0, _elementsInteractions.fillInput)(page, 'input#dtFromDate_textBox', startDate.format(DATE_FORMAT));
  await (0, _elementsInteractions.clickButton)(page, 'input#btnDisplayDates');
  await (0, _navigation.waitForNavigation)(page);
}
async function getAccountNumber(page) {
  const selectedSnifAccount = await page.$eval('#ddlAccounts_m_ddl option[selected="selected"]', option => {
    return option.innerText;
  });
  return selectedSnifAccount.replace('/', '_');
}
async function expandTransactionsTable(page) {
  const hasExpandAllButton = await (0, _elementsInteractions.elementPresentOnPage)(page, "a[id*='lnkCtlExpandAll']");
  if (hasExpandAllButton) {
    await (0, _elementsInteractions.clickButton)(page, "a[id*='lnkCtlExpandAll']");
  }
}
async function scrapeTransactionsFromTable(page) {
  const pendingTxns = await extractTransactionsFromTable(page, PENDING_TRANSACTIONS_TABLE_ID, _transactions.TransactionStatuses.Pending);
  const completedTxns = await extractTransactionsFromTable(page, COMPLETED_TRANSACTIONS_TABLE_ID, _transactions.TransactionStatuses.Completed);
  const txns = [...pendingTxns, ...completedTxns];
  return convertTransactions(txns);
}
async function getAccountTransactions(page) {
  await Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, `#${COMPLETED_TRANSACTIONS_TABLE_ID}`, false), (0, _elementsInteractions.waitUntilElementFound)(page, `.${ERROR_MESSAGE_CLASS}`, false)]);
  const noTransactionInRangeError = await isNoTransactionInDateRangeError(page);
  if (noTransactionInRangeError) {
    return [];
  }
  await expandTransactionsTable(page);
  return scrapeTransactionsFromTable(page);
}
async function fetchAccountData(page, startDate, accountId) {
  await chooseAccount(page, accountId);
  await searchByDates(page, startDate);
  const accountNumber = await getAccountNumber(page);
  const txns = await getAccountTransactions(page);
  return {
    accountNumber,
    txns
  };
}
async function fetchAccounts(page, startDate) {
  const accounts = [];
  const accountsList = await (0, _elementsInteractions.dropdownElements)(page, ACCOUNTS_DROPDOWN_SELECTOR);
  for (const account of accountsList) {
    if (account.value !== '-1') {
      // Skip "All accounts" option
      const accountData = await fetchAccountData(page, startDate, account.value);
      accounts.push(accountData);
    }
  }
  return accounts;
}
async function waitForPostLogin(page) {
  return Promise.race([(0, _elementsInteractions.waitUntilElementFound)(page, '#signoff', true), (0, _elementsInteractions.waitUntilElementFound)(page, '#restore', true)]);
}
class UnionBankScraper extends _baseScraperWithBrowser.BaseScraperWithBrowser {
  getLoginOptions(credentials) {
    return {
      loginUrl: `${BASE_URL}`,
      fields: createLoginFields(credentials),
      submitButtonSelector: '#enter',
      postAction: async () => waitForPostLogin(this.page),
      possibleResults: getPossibleLoginResults()
    };
  }
  async fetchData() {
    const defaultStartMoment = (0, _moment.default)().subtract(1, 'years').add(1, 'day');
    const startDate = this.options.startDate || defaultStartMoment.toDate();
    const startMoment = _moment.default.max(defaultStartMoment, (0, _moment.default)(startDate));
    await this.navigateTo(TRANSACTIONS_URL);
    const accounts = await fetchAccounts(this.page, startMoment);
    return {
      success: true,
      accounts
    };
  }
}
var _default = exports.default = UnionBankScraper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9tZW50IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfY29uc3RhbnRzIiwiX2VsZW1lbnRzSW50ZXJhY3Rpb25zIiwiX25hdmlnYXRpb24iLCJfdHJhbnNhY3Rpb25zIiwiX2Jhc2VTY3JhcGVyV2l0aEJyb3dzZXIiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJCQVNFX1VSTCIsIlRSQU5TQUNUSU9OU19VUkwiLCJEQVRFX0ZPUk1BVCIsIk5PX1RSQU5TQUNUSU9OX0lOX0RBVEVfUkFOR0VfVEVYVCIsIkRBVEVfSEVBREVSIiwiREVTQ1JJUFRJT05fSEVBREVSIiwiUkVGRVJFTkNFX0hFQURFUiIsIkRFQklUX0hFQURFUiIsIkNSRURJVF9IRUFERVIiLCJQRU5ESU5HX1RSQU5TQUNUSU9OU19UQUJMRV9JRCIsIkNPTVBMRVRFRF9UUkFOU0FDVElPTlNfVEFCTEVfSUQiLCJFUlJPUl9NRVNTQUdFX0NMQVNTIiwiQUNDT1VOVFNfRFJPUERPV05fU0VMRUNUT1IiLCJnZXRQb3NzaWJsZUxvZ2luUmVzdWx0cyIsInVybHMiLCJMb2dpblJlc3VsdHMiLCJTdWNjZXNzIiwiSW52YWxpZFBhc3N3b3JkIiwiY3JlYXRlTG9naW5GaWVsZHMiLCJjcmVkZW50aWFscyIsInNlbGVjdG9yIiwidmFsdWUiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiZ2V0QW1vdW50RGF0YSIsImFtb3VudFN0ciIsImFtb3VudFN0ckNvcHkiLCJyZXBsYWNlIiwicGFyc2VGbG9hdCIsImdldFR4bkFtb3VudCIsInR4biIsImNyZWRpdCIsImRlYml0IiwiTnVtYmVyIiwiaXNOYU4iLCJjb252ZXJ0VHJhbnNhY3Rpb25zIiwidHhucyIsIm1hcCIsImNvbnZlcnRlZERhdGUiLCJtb21lbnQiLCJkYXRlIiwidG9JU09TdHJpbmciLCJjb252ZXJ0ZWRBbW91bnQiLCJ0eXBlIiwiVHJhbnNhY3Rpb25UeXBlcyIsIk5vcm1hbCIsImlkZW50aWZpZXIiLCJyZWZlcmVuY2UiLCJwYXJzZUludCIsInVuZGVmaW5lZCIsInByb2Nlc3NlZERhdGUiLCJvcmlnaW5hbEFtb3VudCIsIm9yaWdpbmFsQ3VycmVuY3kiLCJTSEVLRUxfQ1VSUkVOQ1kiLCJjaGFyZ2VkQW1vdW50Iiwic3RhdHVzIiwiZGVzY3JpcHRpb24iLCJtZW1vIiwiZ2V0VHJhbnNhY3Rpb25EYXRlIiwidGRzIiwidHhuc1RhYmxlSGVhZGVycyIsInRyaW0iLCJnZXRUcmFuc2FjdGlvbkRlc2NyaXB0aW9uIiwiZ2V0VHJhbnNhY3Rpb25SZWZlcmVuY2UiLCJnZXRUcmFuc2FjdGlvbkRlYml0IiwiZ2V0VHJhbnNhY3Rpb25DcmVkaXQiLCJleHRyYWN0VHJhbnNhY3Rpb25EZXRhaWxzIiwidHhuUm93IiwidHhuU3RhdHVzIiwiaW5uZXJUZHMiLCJpc0V4cGFuZGVkRGVzY1JvdyIsImlkIiwiZWRpdExhc3RUcmFuc2FjdGlvbkRlc2MiLCJsYXN0VHhuIiwiaGFuZGxlVHJhbnNhY3Rpb25Sb3ciLCJ0eG5UeXBlIiwibGFzdFRyYW5zYWN0aW9uIiwicG9wIiwicHVzaCIsIkVycm9yIiwiZ2V0VHJhbnNhY3Rpb25zVGFibGVIZWFkZXJzIiwicGFnZSIsInRhYmxlVHlwZUlkIiwiaGVhZGVyc01hcCIsImhlYWRlcnNPYmpzIiwicGFnZUV2YWxBbGwiLCJ0aHMiLCJ0aCIsImluZGV4IiwidGV4dCIsImlubmVyVGV4dCIsImhlYWRlck9iaiIsImV4dHJhY3RUcmFuc2FjdGlvbnNGcm9tVGFibGUiLCJ0cmFuc2FjdGlvbnNUYWJsZUhlYWRlcnMiLCJ0cmFuc2FjdGlvbnNSb3dzIiwidHJzIiwidHIiLCJnZXRBdHRyaWJ1dGUiLCJBcnJheSIsImZyb20iLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInRkIiwiaXNOb1RyYW5zYWN0aW9uSW5EYXRlUmFuZ2VFcnJvciIsImhhc0Vycm9ySW5mb0VsZW1lbnQiLCJlbGVtZW50UHJlc2VudE9uUGFnZSIsImVycm9yVGV4dCIsIiRldmFsIiwiZXJyb3JFbGVtZW50IiwiY2hvb3NlQWNjb3VudCIsImFjY291bnRJZCIsImhhc0Ryb3BEb3duTGlzdCIsImRyb3Bkb3duU2VsZWN0Iiwic2VhcmNoQnlEYXRlcyIsInN0YXJ0RGF0ZSIsIndhaXRVbnRpbEVsZW1lbnRGb3VuZCIsImZpbGxJbnB1dCIsImZvcm1hdCIsImNsaWNrQnV0dG9uIiwid2FpdEZvck5hdmlnYXRpb24iLCJnZXRBY2NvdW50TnVtYmVyIiwic2VsZWN0ZWRTbmlmQWNjb3VudCIsIm9wdGlvbiIsImV4cGFuZFRyYW5zYWN0aW9uc1RhYmxlIiwiaGFzRXhwYW5kQWxsQnV0dG9uIiwic2NyYXBlVHJhbnNhY3Rpb25zRnJvbVRhYmxlIiwicGVuZGluZ1R4bnMiLCJUcmFuc2FjdGlvblN0YXR1c2VzIiwiUGVuZGluZyIsImNvbXBsZXRlZFR4bnMiLCJDb21wbGV0ZWQiLCJnZXRBY2NvdW50VHJhbnNhY3Rpb25zIiwiUHJvbWlzZSIsInJhY2UiLCJub1RyYW5zYWN0aW9uSW5SYW5nZUVycm9yIiwiZmV0Y2hBY2NvdW50RGF0YSIsImFjY291bnROdW1iZXIiLCJmZXRjaEFjY291bnRzIiwiYWNjb3VudHMiLCJhY2NvdW50c0xpc3QiLCJkcm9wZG93bkVsZW1lbnRzIiwiYWNjb3VudCIsImFjY291bnREYXRhIiwid2FpdEZvclBvc3RMb2dpbiIsIlVuaW9uQmFua1NjcmFwZXIiLCJCYXNlU2NyYXBlcldpdGhCcm93c2VyIiwiZ2V0TG9naW5PcHRpb25zIiwibG9naW5VcmwiLCJmaWVsZHMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsInBvc3RBY3Rpb24iLCJwb3NzaWJsZVJlc3VsdHMiLCJmZXRjaERhdGEiLCJkZWZhdWx0U3RhcnRNb21lbnQiLCJzdWJ0cmFjdCIsImFkZCIsIm9wdGlvbnMiLCJ0b0RhdGUiLCJzdGFydE1vbWVudCIsIm1heCIsIm5hdmlnYXRlVG8iLCJzdWNjZXNzIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjcmFwZXJzL3VuaW9uLWJhbmsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbWVudCwgeyB0eXBlIE1vbWVudCB9IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyB0eXBlIFBhZ2UgfSBmcm9tICdwdXBwZXRlZXItY29yZSc7XG5pbXBvcnQgeyBTSEVLRUxfQ1VSUkVOQ1kgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgY2xpY2tCdXR0b24sXG4gIGRyb3Bkb3duRWxlbWVudHMsXG4gIGRyb3Bkb3duU2VsZWN0LFxuICBlbGVtZW50UHJlc2VudE9uUGFnZSxcbiAgZmlsbElucHV0LFxuICBwYWdlRXZhbEFsbCxcbiAgd2FpdFVudGlsRWxlbWVudEZvdW5kLFxufSBmcm9tICcuLi9oZWxwZXJzL2VsZW1lbnRzLWludGVyYWN0aW9ucyc7XG5pbXBvcnQgeyB3YWl0Rm9yTmF2aWdhdGlvbiB9IGZyb20gJy4uL2hlbHBlcnMvbmF2aWdhdGlvbic7XG5pbXBvcnQge1xuICBUcmFuc2FjdGlvblN0YXR1c2VzLFxuICBUcmFuc2FjdGlvblR5cGVzLFxuICB0eXBlIFRyYW5zYWN0aW9uLFxuICB0eXBlIFRyYW5zYWN0aW9uc0FjY291bnQsXG59IGZyb20gJy4uL3RyYW5zYWN0aW9ucyc7XG5pbXBvcnQgeyBCYXNlU2NyYXBlcldpdGhCcm93c2VyLCBMb2dpblJlc3VsdHMsIHR5cGUgUG9zc2libGVMb2dpblJlc3VsdHMgfSBmcm9tICcuL2Jhc2Utc2NyYXBlci13aXRoLWJyb3dzZXInO1xuXG5jb25zdCBCQVNFX1VSTCA9ICdodHRwczovL2hiLnVuaW9uYmFuay5jby5pbCc7XG5jb25zdCBUUkFOU0FDVElPTlNfVVJMID0gYCR7QkFTRV9VUkx9L2VCYW5raW5nL0FjY291bnRzL0V4dGVuZGVkQWN0aXZpdHkuYXNweCMvYDtcbmNvbnN0IERBVEVfRk9STUFUID0gJ0REL01NL1lZJztcbmNvbnN0IE5PX1RSQU5TQUNUSU9OX0lOX0RBVEVfUkFOR0VfVEVYVCA9ICfXnNeQINen15nXmdee15XXqiDXqteg15XXoteV16og157XqteQ15nXnteV16og16LXnCDXpNeZINeU16HXmdeg15XXnyDXqdeU15XXkteT16gnO1xuY29uc3QgREFURV9IRUFERVIgPSAn16rXkNeo15nXmic7XG5jb25zdCBERVNDUklQVElPTl9IRUFERVIgPSAn16rXmdeQ15XXqCc7XG5jb25zdCBSRUZFUkVOQ0VfSEVBREVSID0gJ9eQ16HXnteb16rXkCc7XG5jb25zdCBERUJJVF9IRUFERVIgPSAn15fXldeR15QnO1xuY29uc3QgQ1JFRElUX0hFQURFUiA9ICfXlteb15XXqic7XG5jb25zdCBQRU5ESU5HX1RSQU5TQUNUSU9OU19UQUJMRV9JRCA9ICd0clRvZGF5QWN0aXZpdHlOYXBhVGFibGVVcHBlcic7XG5jb25zdCBDT01QTEVURURfVFJBTlNBQ1RJT05TX1RBQkxFX0lEID0gJ2N0bEFjdGl2aXR5VGFibGUnO1xuY29uc3QgRVJST1JfTUVTU0FHRV9DTEFTUyA9ICdlcnJJbmZvJztcbmNvbnN0IEFDQ09VTlRTX0RST1BET1dOX1NFTEVDVE9SID0gJ3NlbGVjdCNkZGxBY2NvdW50c19tX2RkbCc7XG5cbmZ1bmN0aW9uIGdldFBvc3NpYmxlTG9naW5SZXN1bHRzKCkge1xuICBjb25zdCB1cmxzOiBQb3NzaWJsZUxvZ2luUmVzdWx0cyA9IHt9O1xuICB1cmxzW0xvZ2luUmVzdWx0cy5TdWNjZXNzXSA9IFsvZUJhbmtpbmdcXC9BY2NvdW50cy9dO1xuICB1cmxzW0xvZ2luUmVzdWx0cy5JbnZhbGlkUGFzc3dvcmRdID0gWy9JbnRlcm5hbFNpdGVcXC9DdXN0b21VcGRhdGVcXC9sZXVtaVxcL0xvZ2luUGFnZS5BU1AvXTtcbiAgcmV0dXJuIHVybHM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUxvZ2luRmllbGRzKGNyZWRlbnRpYWxzOiBTY3JhcGVyU3BlY2lmaWNDcmVkZW50aWFscykge1xuICByZXR1cm4gW1xuICAgIHsgc2VsZWN0b3I6ICcjdWlkJywgdmFsdWU6IGNyZWRlbnRpYWxzLnVzZXJuYW1lIH0sXG4gICAgeyBzZWxlY3RvcjogJyNwYXNzd29yZCcsIHZhbHVlOiBjcmVkZW50aWFscy5wYXNzd29yZCB9LFxuICBdO1xufVxuXG5mdW5jdGlvbiBnZXRBbW91bnREYXRhKGFtb3VudFN0cjogc3RyaW5nKSB7XG4gIGNvbnN0IGFtb3VudFN0ckNvcHkgPSBhbW91bnRTdHIucmVwbGFjZSgnLCcsICcnKTtcbiAgcmV0dXJuIHBhcnNlRmxvYXQoYW1vdW50U3RyQ29weSk7XG59XG5cbmludGVyZmFjZSBTY3JhcGVkVHJhbnNhY3Rpb24ge1xuICBjcmVkaXQ6IHN0cmluZztcbiAgZGViaXQ6IHN0cmluZztcbiAgZGF0ZTogc3RyaW5nO1xuICByZWZlcmVuY2U/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIG1lbW86IHN0cmluZztcbiAgc3RhdHVzOiBUcmFuc2FjdGlvblN0YXR1c2VzO1xufVxuXG5mdW5jdGlvbiBnZXRUeG5BbW91bnQodHhuOiBTY3JhcGVkVHJhbnNhY3Rpb24pIHtcbiAgY29uc3QgY3JlZGl0ID0gZ2V0QW1vdW50RGF0YSh0eG4uY3JlZGl0KTtcbiAgY29uc3QgZGViaXQgPSBnZXRBbW91bnREYXRhKHR4bi5kZWJpdCk7XG4gIHJldHVybiAoTnVtYmVyLmlzTmFOKGNyZWRpdCkgPyAwIDogY3JlZGl0KSAtIChOdW1iZXIuaXNOYU4oZGViaXQpID8gMCA6IGRlYml0KTtcbn1cblxuZnVuY3Rpb24gY29udmVydFRyYW5zYWN0aW9ucyh0eG5zOiBTY3JhcGVkVHJhbnNhY3Rpb25bXSk6IFRyYW5zYWN0aW9uW10ge1xuICByZXR1cm4gdHhucy5tYXAoKHR4bikgPT4ge1xuICAgIGNvbnN0IGNvbnZlcnRlZERhdGUgPSBtb21lbnQodHhuLmRhdGUsIERBVEVfRk9STUFUKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGNvbnZlcnRlZEFtb3VudCA9IGdldFR4bkFtb3VudCh0eG4pO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBUcmFuc2FjdGlvblR5cGVzLk5vcm1hbCxcbiAgICAgIGlkZW50aWZpZXI6IHR4bi5yZWZlcmVuY2UgPyBwYXJzZUludCh0eG4ucmVmZXJlbmNlLCAxMCkgOiB1bmRlZmluZWQsXG4gICAgICBkYXRlOiBjb252ZXJ0ZWREYXRlLFxuICAgICAgcHJvY2Vzc2VkRGF0ZTogY29udmVydGVkRGF0ZSxcbiAgICAgIG9yaWdpbmFsQW1vdW50OiBjb252ZXJ0ZWRBbW91bnQsXG4gICAgICBvcmlnaW5hbEN1cnJlbmN5OiBTSEVLRUxfQ1VSUkVOQ1ksXG4gICAgICBjaGFyZ2VkQW1vdW50OiBjb252ZXJ0ZWRBbW91bnQsXG4gICAgICBzdGF0dXM6IHR4bi5zdGF0dXMsXG4gICAgICBkZXNjcmlwdGlvbjogdHhuLmRlc2NyaXB0aW9uLFxuICAgICAgbWVtbzogdHhuLm1lbW8sXG4gICAgfTtcbiAgfSk7XG59XG5cbnR5cGUgVHJhbnNhY3Rpb25zVHIgPSB7IGlkOiBzdHJpbmcsIGlubmVyVGRzOiBUcmFuc2FjdGlvbnNUclRkcyB9O1xudHlwZSBUcmFuc2FjdGlvblRhYmxlSGVhZGVycyA9IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG50eXBlIFRyYW5zYWN0aW9uc1RyVGRzID0gc3RyaW5nW107XG5cbmZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uRGF0ZSh0ZHM6IFRyYW5zYWN0aW9uc1RyVGRzLCB0eG5zVGFibGVIZWFkZXJzOiBUcmFuc2FjdGlvblRhYmxlSGVhZGVycykge1xuICByZXR1cm4gKHRkc1t0eG5zVGFibGVIZWFkZXJzW0RBVEVfSEVBREVSXV0gfHwgJycpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25EZXNjcmlwdGlvbih0ZHM6IFRyYW5zYWN0aW9uc1RyVGRzLCB0eG5zVGFibGVIZWFkZXJzOiBUcmFuc2FjdGlvblRhYmxlSGVhZGVycykge1xuICByZXR1cm4gKHRkc1t0eG5zVGFibGVIZWFkZXJzW0RFU0NSSVBUSU9OX0hFQURFUl1dIHx8ICcnKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uUmVmZXJlbmNlKHRkczogVHJhbnNhY3Rpb25zVHJUZHMsIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzKSB7XG4gIHJldHVybiAodGRzW3R4bnNUYWJsZUhlYWRlcnNbUkVGRVJFTkNFX0hFQURFUl1dIHx8ICcnKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uRGViaXQodGRzOiBUcmFuc2FjdGlvbnNUclRkcywgdHhuc1RhYmxlSGVhZGVyczogVHJhbnNhY3Rpb25UYWJsZUhlYWRlcnMpIHtcbiAgcmV0dXJuICh0ZHNbdHhuc1RhYmxlSGVhZGVyc1tERUJJVF9IRUFERVJdXSB8fCAnJykudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkNyZWRpdCh0ZHM6IFRyYW5zYWN0aW9uc1RyVGRzLCB0eG5zVGFibGVIZWFkZXJzOiBUcmFuc2FjdGlvblRhYmxlSGVhZGVycykge1xuICByZXR1cm4gKHRkc1t0eG5zVGFibGVIZWFkZXJzW0NSRURJVF9IRUFERVJdXSB8fCAnJykudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0VHJhbnNhY3Rpb25EZXRhaWxzKHR4blJvdzogVHJhbnNhY3Rpb25zVHIsIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzLCB0eG5TdGF0dXM6IFRyYW5zYWN0aW9uU3RhdHVzZXMpOiBTY3JhcGVkVHJhbnNhY3Rpb24ge1xuICBjb25zdCB0ZHMgPSB0eG5Sb3cuaW5uZXJUZHM7XG4gIHJldHVybiB7XG4gICAgc3RhdHVzOiB0eG5TdGF0dXMsXG4gICAgZGF0ZTogZ2V0VHJhbnNhY3Rpb25EYXRlKHRkcywgdHhuc1RhYmxlSGVhZGVycyksXG4gICAgZGVzY3JpcHRpb246IGdldFRyYW5zYWN0aW9uRGVzY3JpcHRpb24odGRzLCB0eG5zVGFibGVIZWFkZXJzKSxcbiAgICByZWZlcmVuY2U6IGdldFRyYW5zYWN0aW9uUmVmZXJlbmNlKHRkcywgdHhuc1RhYmxlSGVhZGVycyksXG4gICAgZGViaXQ6IGdldFRyYW5zYWN0aW9uRGViaXQodGRzLCB0eG5zVGFibGVIZWFkZXJzKSxcbiAgICBjcmVkaXQ6IGdldFRyYW5zYWN0aW9uQ3JlZGl0KHRkcywgdHhuc1RhYmxlSGVhZGVycyksXG4gICAgbWVtbzogJycsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGlzRXhwYW5kZWREZXNjUm93KHR4blJvdzogVHJhbnNhY3Rpb25zVHIpIHtcbiAgcmV0dXJuIHR4blJvdy5pZCA9PT0gJ3Jvd0FkZGVkJztcbn1cblxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmZ1bmN0aW9uIGVkaXRMYXN0VHJhbnNhY3Rpb25EZXNjKHR4blJvdzogVHJhbnNhY3Rpb25zVHIsIGxhc3RUeG46IFNjcmFwZWRUcmFuc2FjdGlvbik6IFNjcmFwZWRUcmFuc2FjdGlvbiB7XG4gIGxhc3RUeG4uZGVzY3JpcHRpb24gPSBgJHtsYXN0VHhuLmRlc2NyaXB0aW9ufSAke3R4blJvdy5pbm5lclRkc1swXX1gO1xuICByZXR1cm4gbGFzdFR4bjtcbn1cblxuZnVuY3Rpb24gaGFuZGxlVHJhbnNhY3Rpb25Sb3codHhuczogU2NyYXBlZFRyYW5zYWN0aW9uW10sIHR4bnNUYWJsZUhlYWRlcnM6IFRyYW5zYWN0aW9uVGFibGVIZWFkZXJzLCB0eG5Sb3c6IFRyYW5zYWN0aW9uc1RyLCB0eG5UeXBlOiBUcmFuc2FjdGlvblN0YXR1c2VzKSB7XG4gIGlmIChpc0V4cGFuZGVkRGVzY1Jvdyh0eG5Sb3cpKSB7XG4gICAgY29uc3QgbGFzdFRyYW5zYWN0aW9uID0gdHhucy5wb3AoKTtcbiAgICBpZiAobGFzdFRyYW5zYWN0aW9uKSB7XG4gICAgICB0eG5zLnB1c2goZWRpdExhc3RUcmFuc2FjdGlvbkRlc2ModHhuUm93LCBsYXN0VHJhbnNhY3Rpb24pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnRlcm5hbCB1bmlvbi1iYW5rIGVycm9yJyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHR4bnMucHVzaChleHRyYWN0VHJhbnNhY3Rpb25EZXRhaWxzKHR4blJvdywgdHhuc1RhYmxlSGVhZGVycywgdHhuVHlwZSkpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uc1RhYmxlSGVhZGVycyhwYWdlOiBQYWdlLCB0YWJsZVR5cGVJZDogc3RyaW5nKSB7XG4gIGNvbnN0IGhlYWRlcnNNYXA6IFJlY29yZDxzdHJpbmcsIGFueT4gPSBbXTtcbiAgY29uc3QgaGVhZGVyc09ianMgPSBhd2FpdCBwYWdlRXZhbEFsbChwYWdlLCBgI1dvcmtTcGFjZUJveCAjJHt0YWJsZVR5cGVJZH0gdHJbY2xhc3M9J2hlYWRlciddIHRoYCwgbnVsbCwgKHRocykgPT4ge1xuICAgIHJldHVybiB0aHMubWFwKCh0aCwgaW5kZXgpID0+ICh7XG4gICAgICB0ZXh0OiAodGggYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dC50cmltKCksXG4gICAgICBpbmRleCxcbiAgICB9KSk7XG4gIH0pO1xuXG4gIGZvciAoY29uc3QgaGVhZGVyT2JqIG9mIGhlYWRlcnNPYmpzKSB7XG4gICAgaGVhZGVyc01hcFtoZWFkZXJPYmoudGV4dF0gPSBoZWFkZXJPYmouaW5kZXg7XG4gIH1cbiAgcmV0dXJuIGhlYWRlcnNNYXA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RUcmFuc2FjdGlvbnNGcm9tVGFibGUocGFnZTogUGFnZSwgdGFibGVUeXBlSWQ6IHN0cmluZywgdHhuVHlwZTogVHJhbnNhY3Rpb25TdGF0dXNlcyk6IFByb21pc2U8U2NyYXBlZFRyYW5zYWN0aW9uW10+IHtcbiAgY29uc3QgdHhuczogU2NyYXBlZFRyYW5zYWN0aW9uW10gPSBbXTtcbiAgY29uc3QgdHJhbnNhY3Rpb25zVGFibGVIZWFkZXJzID0gYXdhaXQgZ2V0VHJhbnNhY3Rpb25zVGFibGVIZWFkZXJzKHBhZ2UsIHRhYmxlVHlwZUlkKTtcblxuICBjb25zdCB0cmFuc2FjdGlvbnNSb3dzID0gYXdhaXQgcGFnZUV2YWxBbGw8VHJhbnNhY3Rpb25zVHJbXT4ocGFnZSwgYCNXb3JrU3BhY2VCb3ggIyR7dGFibGVUeXBlSWR9IHRyW2NsYXNzXTpub3QoW2NsYXNzPSdoZWFkZXInXSlgLCBbXSwgKHRycykgPT4ge1xuICAgIHJldHVybiAodHJzIGFzIEhUTUxFbGVtZW50W10pLm1hcCgodHIpID0+ICh7XG4gICAgICBpZDogKHRyKS5nZXRBdHRyaWJ1dGUoJ2lkJykgfHwgJycsXG4gICAgICBpbm5lclRkczogQXJyYXkuZnJvbSh0ci5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGQnKSkubWFwKCh0ZCkgPT4gKHRkIGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQpLFxuICAgIH0pKTtcbiAgfSk7XG5cbiAgZm9yIChjb25zdCB0eG5Sb3cgb2YgdHJhbnNhY3Rpb25zUm93cykge1xuICAgIGhhbmRsZVRyYW5zYWN0aW9uUm93KHR4bnMsIHRyYW5zYWN0aW9uc1RhYmxlSGVhZGVycywgdHhuUm93LCB0eG5UeXBlKTtcbiAgfVxuICByZXR1cm4gdHhucztcbn1cblxuYXN5bmMgZnVuY3Rpb24gaXNOb1RyYW5zYWN0aW9uSW5EYXRlUmFuZ2VFcnJvcihwYWdlOiBQYWdlKSB7XG4gIGNvbnN0IGhhc0Vycm9ySW5mb0VsZW1lbnQgPSBhd2FpdCBlbGVtZW50UHJlc2VudE9uUGFnZShwYWdlLCBgLiR7RVJST1JfTUVTU0FHRV9DTEFTU31gKTtcbiAgaWYgKGhhc0Vycm9ySW5mb0VsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBwYWdlLiRldmFsKGAuJHtFUlJPUl9NRVNTQUdFX0NMQVNTfWAsIChlcnJvckVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAoZXJyb3JFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIGVycm9yVGV4dC50cmltKCkgPT09IE5PX1RSQU5TQUNUSU9OX0lOX0RBVEVfUkFOR0VfVEVYVDtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNob29zZUFjY291bnQocGFnZTogUGFnZSwgYWNjb3VudElkOiBzdHJpbmcpIHtcbiAgY29uc3QgaGFzRHJvcERvd25MaXN0ID0gYXdhaXQgZWxlbWVudFByZXNlbnRPblBhZ2UocGFnZSwgQUNDT1VOVFNfRFJPUERPV05fU0VMRUNUT1IpO1xuICBpZiAoaGFzRHJvcERvd25MaXN0KSB7XG4gICAgYXdhaXQgZHJvcGRvd25TZWxlY3QocGFnZSwgQUNDT1VOVFNfRFJPUERPV05fU0VMRUNUT1IsIGFjY291bnRJZCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoQnlEYXRlcyhwYWdlOiBQYWdlLCBzdGFydERhdGU6IE1vbWVudCkge1xuICBhd2FpdCBkcm9wZG93blNlbGVjdChwYWdlLCAnc2VsZWN0I2RkbFRyYW5zYWN0aW9uUGVyaW9kJywgJzAwNCcpO1xuICBhd2FpdCB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZSwgJ3NlbGVjdCNkZGxUcmFuc2FjdGlvblBlcmlvZCcpO1xuICBhd2FpdCBmaWxsSW5wdXQoXG4gICAgcGFnZSxcbiAgICAnaW5wdXQjZHRGcm9tRGF0ZV90ZXh0Qm94JyxcbiAgICBzdGFydERhdGUuZm9ybWF0KERBVEVfRk9STUFUKSxcbiAgKTtcbiAgYXdhaXQgY2xpY2tCdXR0b24ocGFnZSwgJ2lucHV0I2J0bkRpc3BsYXlEYXRlcycpO1xuICBhd2FpdCB3YWl0Rm9yTmF2aWdhdGlvbihwYWdlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudE51bWJlcihwYWdlOiBQYWdlKSB7XG4gIGNvbnN0IHNlbGVjdGVkU25pZkFjY291bnQgPSBhd2FpdCBwYWdlLiRldmFsKCcjZGRsQWNjb3VudHNfbV9kZGwgb3B0aW9uW3NlbGVjdGVkPVwic2VsZWN0ZWRcIl0nLCAob3B0aW9uKSA9PiB7XG4gICAgcmV0dXJuIChvcHRpb24gYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dDtcbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdGVkU25pZkFjY291bnQucmVwbGFjZSgnLycsICdfJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4cGFuZFRyYW5zYWN0aW9uc1RhYmxlKHBhZ2U6IFBhZ2UpIHtcbiAgY29uc3QgaGFzRXhwYW5kQWxsQnV0dG9uID0gYXdhaXQgZWxlbWVudFByZXNlbnRPblBhZ2UocGFnZSwgXCJhW2lkKj0nbG5rQ3RsRXhwYW5kQWxsJ11cIik7XG4gIGlmIChoYXNFeHBhbmRBbGxCdXR0b24pIHtcbiAgICBhd2FpdCBjbGlja0J1dHRvbihwYWdlLCBcImFbaWQqPSdsbmtDdGxFeHBhbmRBbGwnXVwiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBzY3JhcGVUcmFuc2FjdGlvbnNGcm9tVGFibGUocGFnZTogUGFnZSk6IFByb21pc2U8VHJhbnNhY3Rpb25bXT4ge1xuICBjb25zdCBwZW5kaW5nVHhucyA9IGF3YWl0IGV4dHJhY3RUcmFuc2FjdGlvbnNGcm9tVGFibGUocGFnZSwgUEVORElOR19UUkFOU0FDVElPTlNfVEFCTEVfSUQsXG4gICAgVHJhbnNhY3Rpb25TdGF0dXNlcy5QZW5kaW5nKTtcbiAgY29uc3QgY29tcGxldGVkVHhucyA9IGF3YWl0IGV4dHJhY3RUcmFuc2FjdGlvbnNGcm9tVGFibGUocGFnZSwgQ09NUExFVEVEX1RSQU5TQUNUSU9OU19UQUJMRV9JRCxcbiAgICBUcmFuc2FjdGlvblN0YXR1c2VzLkNvbXBsZXRlZCk7XG4gIGNvbnN0IHR4bnMgPSBbXG4gICAgLi4ucGVuZGluZ1R4bnMsXG4gICAgLi4uY29tcGxldGVkVHhucyxcbiAgXTtcbiAgcmV0dXJuIGNvbnZlcnRUcmFuc2FjdGlvbnModHhucyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFjY291bnRUcmFuc2FjdGlvbnMocGFnZTogUGFnZSk6IFByb21pc2U8VHJhbnNhY3Rpb25bXT4ge1xuICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgIHdhaXRVbnRpbEVsZW1lbnRGb3VuZChwYWdlLCBgIyR7Q09NUExFVEVEX1RSQU5TQUNUSU9OU19UQUJMRV9JRH1gLCBmYWxzZSksXG4gICAgd2FpdFVudGlsRWxlbWVudEZvdW5kKHBhZ2UsIGAuJHtFUlJPUl9NRVNTQUdFX0NMQVNTfWAsIGZhbHNlKSxcbiAgXSk7XG5cbiAgY29uc3Qgbm9UcmFuc2FjdGlvbkluUmFuZ2VFcnJvciA9IGF3YWl0IGlzTm9UcmFuc2FjdGlvbkluRGF0ZVJhbmdlRXJyb3IocGFnZSk7XG4gIGlmIChub1RyYW5zYWN0aW9uSW5SYW5nZUVycm9yKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgYXdhaXQgZXhwYW5kVHJhbnNhY3Rpb25zVGFibGUocGFnZSk7XG4gIHJldHVybiBzY3JhcGVUcmFuc2FjdGlvbnNGcm9tVGFibGUocGFnZSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQWNjb3VudERhdGEocGFnZTogUGFnZSwgc3RhcnREYXRlOiBNb21lbnQsIGFjY291bnRJZDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2FjdGlvbnNBY2NvdW50PiB7XG4gIGF3YWl0IGNob29zZUFjY291bnQocGFnZSwgYWNjb3VudElkKTtcbiAgYXdhaXQgc2VhcmNoQnlEYXRlcyhwYWdlLCBzdGFydERhdGUpO1xuICBjb25zdCBhY2NvdW50TnVtYmVyID0gYXdhaXQgZ2V0QWNjb3VudE51bWJlcihwYWdlKTtcbiAgY29uc3QgdHhucyA9IGF3YWl0IGdldEFjY291bnRUcmFuc2FjdGlvbnMocGFnZSk7XG4gIHJldHVybiB7XG4gICAgYWNjb3VudE51bWJlcixcbiAgICB0eG5zLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaEFjY291bnRzKHBhZ2U6IFBhZ2UsIHN0YXJ0RGF0ZTogTW9tZW50KSB7XG4gIGNvbnN0IGFjY291bnRzOiBUcmFuc2FjdGlvbnNBY2NvdW50W10gPSBbXTtcbiAgY29uc3QgYWNjb3VudHNMaXN0ID0gYXdhaXQgZHJvcGRvd25FbGVtZW50cyhwYWdlLCBBQ0NPVU5UU19EUk9QRE9XTl9TRUxFQ1RPUik7XG4gIGZvciAoY29uc3QgYWNjb3VudCBvZiBhY2NvdW50c0xpc3QpIHtcbiAgICBpZiAoYWNjb3VudC52YWx1ZSAhPT0gJy0xJykgeyAvLyBTa2lwIFwiQWxsIGFjY291bnRzXCIgb3B0aW9uXG4gICAgICBjb25zdCBhY2NvdW50RGF0YSA9IGF3YWl0IGZldGNoQWNjb3VudERhdGEocGFnZSwgc3RhcnREYXRlLCBhY2NvdW50LnZhbHVlKTtcbiAgICAgIGFjY291bnRzLnB1c2goYWNjb3VudERhdGEpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYWNjb3VudHM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JQb3N0TG9naW4ocGFnZTogUGFnZSkge1xuICByZXR1cm4gUHJvbWlzZS5yYWNlKFtcbiAgICB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZSwgJyNzaWdub2ZmJywgdHJ1ZSksXG4gICAgd2FpdFVudGlsRWxlbWVudEZvdW5kKHBhZ2UsICcjcmVzdG9yZScsIHRydWUpLFxuICBdKTtcbn1cblxudHlwZSBTY3JhcGVyU3BlY2lmaWNDcmVkZW50aWFscyA9IHsgdXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyB9O1xuXG5jbGFzcyBVbmlvbkJhbmtTY3JhcGVyIGV4dGVuZHMgQmFzZVNjcmFwZXJXaXRoQnJvd3NlcjxTY3JhcGVyU3BlY2lmaWNDcmVkZW50aWFscz4ge1xuICBnZXRMb2dpbk9wdGlvbnMoY3JlZGVudGlhbHM6IFNjcmFwZXJTcGVjaWZpY0NyZWRlbnRpYWxzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvZ2luVXJsOiBgJHtCQVNFX1VSTH1gLFxuICAgICAgZmllbGRzOiBjcmVhdGVMb2dpbkZpZWxkcyhjcmVkZW50aWFscyksXG4gICAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJyNlbnRlcicsXG4gICAgICBwb3N0QWN0aW9uOiBhc3luYyAoKSA9PiB3YWl0Rm9yUG9zdExvZ2luKHRoaXMucGFnZSksXG4gICAgICBwb3NzaWJsZVJlc3VsdHM6IGdldFBvc3NpYmxlTG9naW5SZXN1bHRzKCksXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGZldGNoRGF0YSgpIHtcbiAgICBjb25zdCBkZWZhdWx0U3RhcnRNb21lbnQgPSBtb21lbnQoKS5zdWJ0cmFjdCgxLCAneWVhcnMnKS5hZGQoMSwgJ2RheScpO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMub3B0aW9ucy5zdGFydERhdGUgfHwgZGVmYXVsdFN0YXJ0TW9tZW50LnRvRGF0ZSgpO1xuICAgIGNvbnN0IHN0YXJ0TW9tZW50ID0gbW9tZW50Lm1heChkZWZhdWx0U3RhcnRNb21lbnQsIG1vbWVudChzdGFydERhdGUpKTtcblxuICAgIGF3YWl0IHRoaXMubmF2aWdhdGVUbyhUUkFOU0FDVElPTlNfVVJMKTtcblxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgZmV0Y2hBY2NvdW50cyh0aGlzLnBhZ2UsIHN0YXJ0TW9tZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgYWNjb3VudHMsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBVbmlvbkJhbmtTY3JhcGVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBQyxVQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxxQkFBQSxHQUFBRixPQUFBO0FBU0EsSUFBQUcsV0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksYUFBQSxHQUFBSixPQUFBO0FBTUEsSUFBQUssdUJBQUEsR0FBQUwsT0FBQTtBQUE4RyxTQUFBRCx1QkFBQU8sQ0FBQSxXQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTtBQUU5RyxNQUFNRyxRQUFRLEdBQUcsNEJBQTRCO0FBQzdDLE1BQU1DLGdCQUFnQixHQUFHLEdBQUdELFFBQVEsNENBQTRDO0FBQ2hGLE1BQU1FLFdBQVcsR0FBRyxVQUFVO0FBQzlCLE1BQU1DLGlDQUFpQyxHQUFHLDhDQUE4QztBQUN4RixNQUFNQyxXQUFXLEdBQUcsT0FBTztBQUMzQixNQUFNQyxrQkFBa0IsR0FBRyxP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